%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                       PLOT For Blessing                               %%
%%                                                                       %%
%%                      T. Lasserre, 18/03/2019                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Run List
% 50531  50532  50533  50534  50535  50536  50537  50538  50539  50540  
% 50541  50542  50543  50544  50545  50546  50547  50548  50549  50550  
% 50551  50552  50553  50554  50555  50556  50557  50558  50559

% 
SPR=MultiRunAnalysis(...
    'DataType','Real',...
    'RunList','KITNUSCAN',...
    'exclDataStart',2,...
    'fixPar','1 5 6 7 8 9 10',...
    'chi2','chi2Stat',...
    'ELossFlag','KatrinD2',...
    'StackTolerance',0.2,...
    'NonPoissonScaleFactor',1.5,...
    'Debug','ON');

SPR.chi2='chi2Stat';
%SPR.FitRunList('Recompute','ON')
%SPR.FitRunList_SlowControl
return;

%% Systematics
%SPR.chi2='chi2CMShape';
systematics = struct(...
    'RF_EL','ON',...
    'RF_BF','ON',...
    'RF_RX','ON',...
    'FSD','ON',...
    'TASR','ON',...
    'TCoff_RAD','ON',...
    'TCoff_OTHER','ON',...
    'DOPoff','OFF');
CMoptions   = {
    'WGTS_TASR_RelErr',0.005,...
    'FSDNorm_RelErr',0.01,...
    'FSDShapeGS_RelErr',0.04,...
    'FSDShapeES_RelErr',0.18,...
    'MACE_Ba_T_RelErr',0.01,...
    'MACE_Bmax_T_RelErr',0.002,...
    'WGTS_B_T_RelErr',0.025,...
    'WGTS_CD_MolPerCm2_RelErr',0.05,...
    'ISXsection_RelErr',0.02,...
    'BkgCM','ON',...
    'Stack','ON'...
    };
SPR.ComputeCM('RecomputeFlag','ON','SysEffects',systematics,CMoptions{:});

%% Fit
SPR.Fit('CATS','OFF');
SPR.PlotFit('Mode','Rate','saveplot','png')

%% PlotDataModel
SPR.PlotDataModel_KNM1
